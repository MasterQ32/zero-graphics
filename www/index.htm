<!doctype html>
<html lang="en">

<head>
    <meta charset=" utf-8">
    <title>OpenGL ES 2.0 - Zig Demo</title>

    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #444;
            color: #98ffb1;
        }

        canvas {
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            padding: 2px;

        }
    </style>

    <script type="module" defer="true">
        import getEnv from "./binding.js";

        const canvas_element = document.getElementById("render-canvas");
        var globalInstance;

        let env = {
            ...getEnv(canvas_element, () => globalInstance),
        };

        fetch("demo_application.wasm")
            .then((response) => response.arrayBuffer())
            .then((bytes) => WebAssembly.instantiate(bytes, { env }))
            .then((results) => results.instance)
            .then((instance) => {
                globalInstance = instance;
                let res = instance.exports.app_init();
                if (res == 0) {
                    // run the update loop until the app dies
                    function update() {
                        canvas_element.width = canvas_element.clientWidth;
                        canvas_element.height = canvas_element.clientHeight;

                        let res = instance.exports.app_update();
                        if (res == 0) {
                            requestAnimationFrame(update);
                        } else {
                            console.log("app_update returned ", res);
                        }
                    }

                    requestAnimationFrame(update);
                }
                else {
                    console.log("app_init returned ", res);
                }
            });
    </script>
</head>

<body>
    <canvas id="render-canvas" tabindex="1">
    </canvas>
    <h1>OpenGL ES 2.0 - Zig Demo</h1>
</body>

</html>